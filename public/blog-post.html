<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Post - RatixPay</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="/js/dark-mode-manager.js"></script>
    <script src="/js/server-check.js"></script>
    <script src="/js/config.js"></script>
    <style>
        :root {
            --primary: #F64C00;
            --primary-dark: #e55a00;
            --primary-light: #ff7a33;
            --secondary: #10b981;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-light: #9ca3af;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-tertiary: #f3f4f6;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --text-primary: #f3f4f6;
            --text-secondary: #d1d5db;
            --text-light: #9ca3af;
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --bg-tertiary: #374151;
            --border-color: #4b5563;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.8;
            font-size: 18px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 60px 20px;
            box-shadow: var(--shadow-lg);
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 50px 20px;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 40px;
            flex: 1;
        }

        .content-area {
            max-width: 800px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .sidebar-widget {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 28px;
            box-shadow: var(--shadow-sm);
        }

        .sidebar-widget h3 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .back-link {
            color: white;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            opacity: 0.95;
            font-weight: 500;
            transition: opacity 0.2s ease;
            padding: 8px 16px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }

        .back-link:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.2);
        }

        .post-header {
            margin-bottom: 40px;
        }

        .post-category {
            display: inline-block;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 25px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 18px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .post-title {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 20px;
            line-height: 1.2;
            letter-spacing: -0.02em;
        }

        .post-subtitle {
            font-size: 1.35rem;
            opacity: 0.95;
            margin-bottom: 25px;
            font-weight: 300;
            line-height: 1.5;
        }

        .post-meta {
            display: flex;
            gap: 24px;
            font-size: 0.95rem;
            opacity: 0.9;
            flex-wrap: wrap;
        }

        .post-meta span {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .post-image {
            width: 100%;
            max-height: 500px;
            object-fit: cover;
            border-radius: 16px;
            margin: 40px 0;
            box-shadow: var(--shadow-lg);
        }

        .post-content {
            font-size: 1.125rem;
            line-height: 1.9;
            margin-bottom: 50px;
            color: var(--text-primary);
        }

        .post-content p {
            margin-bottom: 1.5em;
        }

        .post-content h2 {
            font-size: 2rem;
            font-weight: 700;
            margin-top: 2em;
            margin-bottom: 1em;
            color: var(--text-primary);
            line-height: 1.3;
        }

        .post-content h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 1.5em;
            margin-bottom: 0.75em;
            color: var(--text-primary);
        }

        .post-content ul, .post-content ol {
            margin-bottom: 1.5em;
            padding-left: 2em;
        }

        .post-content li {
            margin-bottom: 0.5em;
        }

        .post-content a {
            color: var(--primary);
            text-decoration: underline;
            transition: color 0.2s ease;
        }

        .post-content a:hover {
            color: var(--primary-dark);
        }

        .post-content img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            margin: 2em 0;
            box-shadow: var(--shadow-md);
        }

        .post-content blockquote {
            border-left: 4px solid var(--primary);
            padding-left: 1.5em;
            margin: 2em 0;
            font-style: italic;
            color: var(--text-secondary);
        }

        .post-content code {
            background: var(--bg-tertiary);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
            font-family: 'Courier New', monospace;
        }

        .post-content pre {
            background: var(--bg-tertiary);
            padding: 1.5em;
            border-radius: 12px;
            overflow-x: auto;
            margin: 2em 0;
        }

        .post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-top: 2px solid var(--border-color);
            border-bottom: 2px solid var(--border-color);
            margin: 40px 0;
        }

        .like-button {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-primary);
        }

        .like-button:hover:not(.liked):not(:disabled) {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .like-button.liked {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            cursor: not-allowed;
            opacity: 0.8;
        }

        .like-button:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
        }

        .share-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .share-btn:hover {
            transform: scale(1.1);
        }

        .share-btn.whatsapp:hover { background: #25d366; color: white; border-color: #25d366; }
        .share-btn.facebook:hover { background: #1877f2; color: white; border-color: #1877f2; }
        .share-btn.twitter:hover { background: #1da1f2; color: white; border-color: #1da1f2; }
        .share-btn.linkedin:hover { background: #0077b5; color: white; border-color: #0077b5; }

        .comments-section {
            margin-top: 80px;
        }

        .comments-section h2 {
            margin-bottom: 32px;
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .comment-form {
            background: var(--bg-secondary);
            padding: 32px;
            border-radius: 16px;
            margin-bottom: 50px;
            border: 1px solid var(--border-color);
        }

        .comment-form h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 24px;
            color: var(--text-primary);
        }

        .comment-form input,
        .comment-form textarea {
            width: 100%;
            padding: 14px 18px;
            margin-bottom: 18px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .comment-form input:focus,
        .comment-form textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(246, 76, 0, 0.1);
        }

        .comment-form textarea {
            min-height: 120px;
            resize: vertical;
        }

        .comment-form button {
            padding: 14px 32px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .comment-form button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .comment {
            background: transparent;
            padding: 12px 0;
            margin-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.2s ease;
            position: relative;
        }

        .comment:last-child {
            border-bottom: none;
        }

        .comment:hover {
            background: var(--bg-secondary);
            padding: 12px;
            border-radius: 6px;
            border-bottom: none;
        }

        .comment.reply {
            margin-left: 40px;
            padding-left: 12px;
            border-left: 2px solid var(--border-color);
            position: relative;
        }

        .comment.reply::before {
            display: none;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .comment-author-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #F64C00 0%, #FF6B35 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 12px;
            flex-shrink: 0;
        }

        .comment-author {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .comment-date {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-left: 8px;
        }

        .comment-content {
            margin: 6px 0 10px 0;
            color: var(--text-primary);
            line-height: 1.5;
            font-size: 0.875rem;
            word-wrap: break-word;
        }

        .comment-content.short {
            max-height: 120px;
            overflow: hidden;
            position: relative;
        }

        .comment-content.short::after {
            content: '...';
            position: absolute;
            bottom: 0;
            right: 0;
            background: linear-gradient(to right, transparent, var(--bg-primary) 50%);
            padding-left: 20px;
        }

        .comment-content.expanded {
            max-height: none;
        }

        .comment-content.expanded::after {
            display: none;
        }

        .comment-expand-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 0.85rem;
            padding: 4px 0;
            margin-top: 4px;
            text-decoration: underline;
            transition: color 0.2s;
        }

        .comment-expand-btn:hover {
            color: var(--primary-dark);
        }

        .comment-actions {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 6px;
        }

        .comment-action {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.8rem;
            transition: color 0.2s;
            padding: 3px 6px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .comment-action:hover {
            color: var(--primary);
            background: rgba(246, 76, 0, 0.08);
        }

        .toggle-replies-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 0.85rem;
            padding: 4px 8px;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }

        .toggle-replies-btn:hover {
            color: var(--primary-dark);
            background: rgba(246, 76, 0, 0.08);
            border-radius: 4px;
        }

        .replies-container {
            margin-top: 12px;
            transition: all 0.3s ease;
        }

        .replies-container.collapsed {
            display: none;
        }

        .replies-container:not(.collapsed) {
            display: block;
        }

        .comment-reactions {
            display: flex;
            gap: 4px;
            align-items: center;
            margin-top: 6px;
            flex-wrap: wrap;
        }

        .reaction-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            padding: 3px 8px;
            border-radius: 14px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 3px;
            color: var(--text-secondary);
        }

        .reaction-btn:hover {
            border-color: var(--primary);
            background: rgba(246, 76, 0, 0.08);
        }

        .reaction-btn.active {
            background: rgba(246, 76, 0, 0.12);
            border-color: var(--primary);
            color: var(--primary);
        }

        .reaction-count {
            font-size: 11px;
            font-weight: 600;
        }

        .reply-form {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
            display: none;
        }

        .reply-form.active {
            display: block;
        }

        .reply-form textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 80px;
            margin-bottom: 8px;
            transition: border-color 0.2s;
        }

        .reply-form textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .reply-form button {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: background 0.2s;
        }

        .reply-form button:hover {
            background: var(--primary-dark);
        }

        .related-post-item {
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .related-post-item:last-child {
            border-bottom: none;
        }

        .related-post-item:hover {
            padding-left: 8px;
        }

        .related-post-item a {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 600;
            font-size: 0.95rem;
            line-height: 1.5;
            transition: color 0.2s ease;
            display: block;
        }

        .related-post-item a:hover {
            color: var(--primary);
        }

        .related-post-meta {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .category-item {
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .category-item:last-child {
            border-bottom: none;
        }

        .category-item a {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: color 0.2s ease;
        }

        .category-item a:hover {
            color: var(--primary);
        }

        .category-count {
            background: var(--bg-tertiary);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .footer {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 50px 20px;
            margin-top: 80px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
        }

        .footer-section h3 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .footer-section p,
        .footer-section a {
            color: var(--text-secondary);
            text-decoration: none;
            line-height: 1.8;
            display: block;
            margin-bottom: 10px;
            transition: color 0.2s ease;
        }

        .footer-section a:hover {
            color: var(--primary);
        }

        .footer-bottom {
            max-width: 1200px;
            margin: 40px auto 0;
            padding-top: 30px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-secondary);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                order: -1;
            }
        }

        @media (max-width: 768px) {
            .post-title {
                font-size: 2rem;
            }

            .main-container {
                padding: 30px 15px;
                gap: 30px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div style="max-width: 1400px; margin: 0 auto;">
            <a href="blog.html" class="back-link">
                <i class="fas fa-arrow-left"></i> Voltar ao Blog
            </a>
            <div class="post-header" id="postHeader">
                <div class="loading">Carregando...</div>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="content-area">
            <div id="postImageContainer"></div>
            <div class="post-content" id="postContent"></div>

            <div class="post-actions">
                <button class="like-button" id="likeButton" onclick="likePost()">
                    <i class="fas fa-heart" id="likeIcon"></i>
                    <span id="likeCount">0</span>
                </button>
                <div class="share-buttons">
                    <div class="share-btn whatsapp" onclick="sharePost('whatsapp')" title="Compartilhar no WhatsApp">
                        <i class="fab fa-whatsapp"></i>
                    </div>
                    <div class="share-btn facebook" onclick="sharePost('facebook')" title="Compartilhar no Facebook">
                        <i class="fab fa-facebook"></i>
                    </div>
                    <div class="share-btn twitter" onclick="sharePost('twitter')" title="Compartilhar no Twitter">
                        <i class="fab fa-twitter"></i>
                    </div>
                    <div class="share-btn linkedin" onclick="sharePost('linkedin')" title="Compartilhar no LinkedIn">
                        <i class="fab fa-linkedin"></i>
                    </div>
                    <div class="share-btn" onclick="copyLink()" title="Copiar Link">
                        <i class="fas fa-link"></i>
                    </div>
                </div>
            </div>

            <div class="comments-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
                    <h2 style="margin: 0;"><i class="fas fa-comments"></i> Coment√°rios</h2>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <label style="font-size: 14px; color: var(--text-secondary);">Ordenar por:</label>
                        <select id="commentSort" onchange="sortComments()" style="padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); font-size: 14px; cursor: pointer;">
                            <option value="recent">Mais recentes</option>
                            <option value="relevant">Mais relevantes</option>
                            <option value="voted">Mais votados</option>
                        </select>
                    </div>
                </div>
                
                <div class="comment-form" id="commentForm">
                    <h3>Deixe seu coment√°rio</h3>
                    <div id="commentAuthMessage" style="display: none; background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 12px; margin-bottom: 16px; color: #856404; font-size: 14px;">
                        <i class="fas fa-info-circle"></i> Voc√™ precisa estar autenticado para comentar.
                        <button onclick="showLoginModal()" style="background: #ffc107; color: #000; border: none; padding: 6px 12px; border-radius: 6px; margin-left: 10px; cursor: pointer; font-weight: 600;">Fazer Login</button>
                    </div>
                    <input type="text" id="commentName" placeholder="Seu nome *" required>
                    <input type="email" id="commentEmail" placeholder="Seu email *" required>
                    <textarea id="commentText" placeholder="Seu coment√°rio *" required></textarea>
                    <button onclick="submitComment()" id="submitCommentBtn">Enviar Coment√°rio</button>
                </div>

                <div id="commentsContainer"></div>
            </div>
            
            <!-- Modal de Login (Mini-popup) -->
            <div id="loginModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; align-items: center; justify-content: center; animation: fadeIn 0.3s ease;">
                <div id="loginModalContent" style="background: var(--bg-primary); padding: 0; border-radius: 16px; max-width: 420px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: slideUp 0.3s ease; overflow: hidden;">
                    <div style="background: linear-gradient(135deg, #F64C00 0%, #FF6B35 100%); padding: 24px; text-align: center;">
                        <h3 style="margin: 0; color: white; font-size: 1.5rem;">üîê Autentica√ß√£o Necess√°ria</h3>
                    </div>
                    <div style="padding: 30px;">
                        <p style="color: var(--text-secondary); margin-bottom: 24px; text-align: center; font-size: 0.95rem;">Fa√ßa login para comentar e reagir aos posts do blog.</p>
                        
                        <div id="loginForm" style="display: flex; flex-direction: column; gap: 12px;">
                            <input type="email" id="loginEmail" placeholder="Seu email" style="padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 0.95rem; transition: border-color 0.2s;">
                            <input type="password" id="loginPassword" placeholder="Sua senha" style="padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 0.95rem; transition: border-color 0.2s;">
                            <div id="loginError" style="display: none; background: #fee; border: 1px solid #fcc; color: #c33; padding: 10px; border-radius: 6px; font-size: 0.85rem; text-align: center;"></div>
                            <button onclick="handleLogin()" id="loginSubmitBtn" style="padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.95rem; transition: background 0.2s;">
                                Entrar
                            </button>
                        </div>
                        
                        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color); text-align: center;">
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 12px;">N√£o tem uma conta?</p>
                            <button onclick="window.location.href='register.html'" style="padding: 10px 20px; background: transparent; color: var(--primary); border: 2px solid var(--primary); border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: all 0.2s;">
                                Criar Conta
                            </button>
                        </div>
                        
                        <div style="margin-top: 16px; text-align: center;">
                            <button onclick="closeLoginModal()" style="background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 0.85rem; text-decoration: underline;">
                                Fechar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        <style>
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }

            @keyframes slideUp {
                from { 
                    transform: translateY(30px);
                    opacity: 0;
                }
                to { 
                    transform: translateY(0);
                    opacity: 1;
                }
            }

            @keyframes slideInRight {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }

            #loginModalContent input:focus {
                outline: none;
                border-color: var(--primary);
            }

            #loginModalContent button:hover {
                opacity: 0.9;
            }

            #loginSubmitBtn:hover {
                background: var(--primary-dark) !important;
            }

            #loginSubmitBtn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
            }
        </style>
        </div>

        <div class="sidebar">
            <div class="sidebar-widget">
                <h3><i class="fas fa-fire"></i> Posts Relacionados</h3>
                <div id="relatedPostsSidebar"></div>
            </div>

            <div class="sidebar-widget">
                <h3><i class="fas fa-tags"></i> Categorias</h3>
                <div id="categoriesSidebar"></div>
            </div>

            <div class="sidebar-widget">
                <h3><i class="fas fa-newspaper"></i> Publica√ß√µes Recentes</h3>
                <div id="recentPostsSidebar"></div>
            </div>

            <div class="sidebar-widget newsletter-widget">
                <h3><i class="fas fa-bell"></i> Newsletter</h3>
                <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 16px;">
                    Receba notifica√ß√µes sobre novos posts, rea√ß√µes e respostas aos seus coment√°rios.
                </p>
                <div id="newsletterForm">
                    <input type="email" id="newsletterEmail" placeholder="Seu email" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; margin-bottom: 10px; font-size: 0.9rem;">
                    <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; font-size: 0.85rem;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="newsletterNovosPosts" checked style="cursor: pointer;">
                            <span>Novos posts</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="newsletterReacoes" checked style="cursor: pointer;">
                            <span>Rea√ß√µes nos coment√°rios</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="newsletterRespostas" checked style="cursor: pointer;">
                            <span>Respostas aos coment√°rios</span>
                        </label>
                    </div>
                    <button onclick="subscribeNewsletter()" id="newsletterBtn" style="width: 100%; padding: 10px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: background 0.2s;">
                        Inscrever-se
                    </button>
                    <div id="newsletterMessage" style="margin-top: 10px; font-size: 0.85rem; text-align: center; display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>RatixPay</h3>
                <p>Plataforma completa para gest√£o de vendas digitais e pagamentos online.</p>
            </div>
            <div class="footer-section">
                <h3>Links R√°pidos</h3>
                <a href="/">In√≠cio</a>
                <a href="/blog.html">Blog</a>
                <a href="/sobre.html">Sobre</a>
                <a href="/contato.html">Contato</a>
            </div>
            <div class="footer-section">
                <h3>Suporte</h3>
                <a href="/ajuda.html">Central de Ajuda</a>
                <a href="/faq.html">Perguntas Frequentes</a>
                <a href="/termos.html">Termos de Uso</a>
                <a href="/privacidade.html">Pol√≠tica de Privacidade</a>
            </div>
            <div class="footer-section">
                <h3>Redes Sociais</h3>
                <a href="#" target="_blank"><i class="fab fa-facebook"></i> Facebook</a>
                <a href="#" target="_blank"><i class="fab fa-twitter"></i> Twitter</a>
                <a href="#" target="_blank"><i class="fab fa-instagram"></i> Instagram</a>
                <a href="#" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 RatixPay. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script>
        const API_BASE = window.API_BASE || '';
        let currentPost = null;
        let currentPostId = null;

        // Fun√ß√£o para inscrever na newsletter
        async function subscribeNewsletter() {
            const email = document.getElementById('newsletterEmail').value;
            const notificarNovosPosts = document.getElementById('newsletterNovosPosts').checked;
            const notificarReacoes = document.getElementById('newsletterReacoes').checked;
            const notificarRespostas = document.getElementById('newsletterRespostas').checked;
            const btn = document.getElementById('newsletterBtn');
            const message = document.getElementById('newsletterMessage');

            if (!email) {
                message.textContent = 'Por favor, insira seu email.';
                message.style.color = '#ef4444';
                message.style.display = 'block';
                return;
            }

            // Validar email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                message.textContent = 'Email inv√°lido.';
                message.style.color = '#ef4444';
                message.style.display = 'block';
                return;
            }

            btn.disabled = true;
            btn.textContent = 'Processando...';

            try {
                const token = localStorage.getItem('authToken') || localStorage.getItem('token') || localStorage.getItem('adminToken');
                const headers = {
                    'Content-Type': 'application/json'
                };
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }

                const response = await fetch(`${API_BASE}/blog/newsletter/subscribe`, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify({
                        email,
                        notificar_novos_posts: notificarNovosPosts,
                        notificar_reacoes: notificarReacoes,
                        notificar_respostas: notificarRespostas
                    })
                });

                const data = await response.json();
                if (data.success) {
                    message.textContent = '‚úÖ Inscrito com sucesso!';
                    message.style.color = '#10b981';
                    message.style.display = 'block';
                    document.getElementById('newsletterEmail').value = '';
                    btn.textContent = 'Inscrito';
                    setTimeout(() => {
                        message.style.display = 'none';
                        btn.disabled = false;
                        btn.textContent = 'Inscrever-se';
                    }, 3000);
                } else {
                    message.textContent = data.message || 'Erro ao inscrever.';
                    message.style.color = '#ef4444';
                    message.style.display = 'block';
                    btn.disabled = false;
                    btn.textContent = 'Inscrever-se';
                }
            } catch (error) {
                console.error('Erro ao inscrever na newsletter:', error);
                message.textContent = 'Erro ao inscrever. Tente novamente.';
                message.style.color = '#ef4444';
                message.style.display = 'block';
                btn.disabled = false;
                btn.textContent = 'Inscrever-se';
            }
        }

        // Verificar status da newsletter ao carregar
        async function checkNewsletterStatus() {
            try {
                const token = localStorage.getItem('authToken') || localStorage.getItem('token') || localStorage.getItem('adminToken');
                
                // Se n√£o tem token, n√£o verificar (usu√°rio n√£o autenticado)
                if (!token) {
                    return;
                }

                const response = await fetch(`${API_BASE}/blog/newsletter/status`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                // Se n√£o for sucesso, apenas logar e continuar (n√£o √© cr√≠tico)
                if (!response.ok) {
                    // Se for 400 ou 401, usu√°rio n√£o autenticado ou token inv√°lido - isso √© OK
                    if (response.status === 400 || response.status === 401) {
                        return;
                    }
                    console.warn('Erro ao verificar status da newsletter:', response.status);
                    return;
                }

                const data = await response.json();
                
                // Atualizar bot√£o apenas se usu√°rio estiver inscrito
                if (data.success && data.subscribed) {
                    const btn = document.getElementById('newsletterBtn');
                    if (btn) {
                        btn.textContent = 'Inscrito';
                        btn.style.background = '#10b981';
                        btn.disabled = true;
                    }
                }
            } catch (error) {
                // N√£o mostrar erro ao usu√°rio - verifica√ß√£o de newsletter n√£o √© cr√≠tica
                console.debug('Erro ao verificar status da newsletter (n√£o cr√≠tico):', error.message);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const slug = urlParams.get('slug');
            if (slug) {
                loadUserInfo();
                loadPost(slug);
                loadCategories();
                loadRecentPosts();
                checkAuth(); // Verificar autentica√ß√£o ao carregar
                checkNewsletterStatus(); // Verificar status da newsletter
            } else {
                window.location.href = 'blog.html';
            }
        });

        // Carregar informa√ß√µes do usu√°rio se autenticado
        async function loadUserInfo() {
            try {
                const token = localStorage.getItem('authToken') || localStorage.getItem('token') || localStorage.getItem('adminToken');
                if (!token) return;

                const response = await fetch(`${API_BASE}/auth/me`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.user) {
                        const nameField = document.getElementById('commentName');
                        const emailField = document.getElementById('commentEmail');
                        if (nameField && emailField) {
                            nameField.value = data.user.nome_completo || data.user.nome || '';
                            emailField.value = data.user.email || '';
                        }
                    }
                }
            } catch (error) {
                // Silenciosamente falha se n√£o autenticado
                console.log('Usu√°rio n√£o autenticado ou erro ao carregar informa√ß√µes');
            }
        }

        async function loadPost(slug) {
            try {
                const response = await fetch(`${API_BASE}/blog/posts/${slug}`);
                const data = await response.json();

                if (data.success) {
                    currentPost = data.data.post;
                    currentPostId = currentPost.id;
                    displayPost(currentPost);
                    displayComments(currentPost.comments || []);
                    displayRelatedPosts(data.data.relatedPosts || []);
                    
                    // Verificar autentica√ß√£o
                    checkAuth();
                    
                    // Registrar visualiza√ß√£o (se ainda n√£o visualizou)
                    registerView(currentPost.id);
                } else {
                    document.querySelector('.content-area').innerHTML = '<div class="loading"><p>Post n√£o encontrado.</p></div>';
                }
            } catch (error) {
                console.error('Erro ao carregar post:', error);
                document.querySelector('.content-area').innerHTML = '<div class="loading"><p>Erro ao carregar post.</p></div>';
            }
        }

        // Fun√ß√£o para decodificar entidades HTML
        function decodeHtmlEntities(text) {
            if (!text) return '';
            const textarea = document.createElement('textarea');
            textarea.innerHTML = text;
            return textarea.value;
        }

        function displayPost(post) {
            const header = document.getElementById('postHeader');
            header.innerHTML = `
                ${post.category ? `<span class="post-category">${escapeHtml(post.category)}</span>` : ''}
                <h1 class="post-title">${escapeHtml(post.title)}</h1>
                ${post.subtitle ? `<p class="post-subtitle">${escapeHtml(post.subtitle)}</p>` : ''}
                <div class="post-meta">
                    <span><i class="fas fa-user"></i> ${escapeHtml(post.author?.nome_completo || 'Admin')}</span>
                    <span><i class="fas fa-calendar"></i> ${formatDate(post.published_at || post.created_at)}</span>
                    <span><i class="fas fa-eye"></i> <span id="viewsCount">${post.views || 0} visualiza√ß√µes</span></span>
                </div>
            `;

            if (post.image) {
                document.getElementById('postImageContainer').innerHTML = `<img src="${escapeHtml(post.image)}" alt="${escapeHtml(post.title)}" class="post-image">`;
            }

            // Decodificar HTML antes de inserir (caso esteja escapado)
            let content = post.content || '';
            // Se o conte√∫do parece estar escapado (cont√©m &lt; ao inv√©s de <), decodificar
            if (content.includes('&lt;') || content.includes('&gt;') || content.includes('&amp;')) {
                content = decodeHtmlEntities(content);
            }
            
            document.getElementById('postContent').innerHTML = content;
            document.getElementById('likeCount').textContent = post.likes || 0;
            document.title = `${post.title} - Blog RatixPay`;
            
            // Verificar e atualizar bot√£o de like
            updateLikeButton(post.id);
        }

        // Fun√ß√£o para formatar data de forma segura com ISO 8601 e fallback
        function formatDate(dateString) {
            if (!dateString) return 'Data n√£o dispon√≠vel';
            
            try {
                let date;
                
                // Tentar parse ISO 8601 primeiro
                if (typeof dateString === 'string') {
                    // Remove espa√ßos extras
                    dateString = dateString.trim();
                    
                    // Verifica se √© ISO 8601 (formato padr√£o)
                    if (dateString.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/)) {
                        date = new Date(dateString);
                    } 
                    // Tentar outros formatos comuns
                    else if (dateString.match(/^\d{4}-\d{2}-\d{2}/)) {
                        date = new Date(dateString + 'T00:00:00');
                    }
                    // Fallback: tentar parse direto
                    else {
                        date = new Date(dateString);
                    }
                } else {
                    date = new Date(dateString);
                }
                
                // Verificar se a data √© v√°lida
                if (isNaN(date.getTime()) || !date.getTime()) {
                    console.warn('Data inv√°lida:', dateString);
                    return 'Data inv√°lida';
                }
                
                // Formato relativo
                const now = new Date();
                const diff = Math.abs(now - date);
                const seconds = Math.floor(diff / 1000);
                const minutes = Math.floor(seconds / 60);
                const hours = Math.floor(minutes / 60);
                const days = Math.floor(hours / 24);
                const weeks = Math.floor(days / 7);
                const months = Math.floor(days / 30);
                const years = Math.floor(days / 365);
                
                // Determinar se √© passado ou futuro
                const isPast = now > date;
                const prefix = isPast ? 'h√°' : 'em';
                
                // Retornar formato relativo se for recente (at√© 1 m√™s)
                if (seconds < 60) return isPast ? 'h√° alguns segundos' : 'em alguns segundos';
                if (minutes < 60) return `${prefix} ${minutes} minuto${minutes > 1 ? 's' : ''}`;
                if (hours < 24) return `${prefix} ${hours} hora${hours > 1 ? 's' : ''}`;
                if (days < 7) return `${prefix} ${days} dia${days > 1 ? 's' : ''}`;
                if (weeks < 4) return `${prefix} ${weeks} semana${weeks > 1 ? 's' : ''}`;
                if (months < 12) return `${prefix} ${months} m√™s${months > 1 ? 'es' : ''}`;
                if (years < 1) return `${prefix} ${years} ano${years > 1 ? 's' : ''}`;
                
                // Se for mais antigo, mostrar data formatada completa
                try {
                    return date.toLocaleDateString('pt-BR', { 
                        day: '2-digit', 
                        month: '2-digit', 
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (formatError) {
                    // Fallback final: formato simples
                    return date.toLocaleDateString('pt-BR');
                }
            } catch (error) {
                console.error('Erro ao formatar data:', error, 'Data original:', dateString);
                return 'Data inv√°lida';
            }
        }

        // Fun√ß√£o para obter iniciais do nome
        function getInitials(name) {
            if (!name) return '?';
            const parts = name.trim().split(' ');
            if (parts.length >= 2) {
                return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
            }
            return name.substring(0, 2).toUpperCase();
        }

        // Fun√ß√£o para ordenar coment√°rios
        let currentSort = 'recent';
        function sortComments() {
            currentSort = document.getElementById('commentSort').value;
            if (currentPost && currentPost.comments) {
                displayComments(currentPost.comments);
            }
        }

        // Fun√ß√£o para truncar texto
        function truncateText(text, maxLength = 200) {
            if (!text || text.length <= maxLength) return { text, isLong: false };
            return { 
                text: text.substring(0, maxLength), 
                fullText: text,
                isLong: true 
            };
        }

        // Fun√ß√£o para expandir/recolher coment√°rio
        function toggleCommentExpand(commentId) {
            const content = document.getElementById(`commentContent-${commentId}`);
            const btn = document.getElementById(`expandBtn-${commentId}`);
            if (content && btn) {
                if (content.classList.contains('expanded')) {
                    // Recolher
                    const fullText = content.dataset.fullText || content.textContent;
                    const truncated = truncateText(fullText, 200);
                    content.innerHTML = truncated.text;
                    content.classList.remove('expanded');
                    btn.textContent = 'Ver mais';
                } else {
                    // Expandir
                    const fullText = content.dataset.fullText || content.textContent;
                    content.innerHTML = fullText;
                    content.classList.add('expanded');
                    btn.textContent = 'Ver menos';
                }
            }
        }

        // Fun√ß√£o para expandir/recolher respostas
        function toggleReplies(commentId) {
            const container = document.getElementById(`repliesContainer-${commentId}`);
            const btn = document.getElementById(`toggleRepliesBtn-${commentId}`);
            if (container && btn) {
                container.classList.toggle('collapsed');
                const icon = btn.querySelector('i');
                if (container.classList.contains('collapsed')) {
                    icon.className = 'fas fa-chevron-down';
                    btn.innerHTML = `<i class="fas fa-chevron-down"></i> Ver ${container.dataset.replyCount || 0} resposta${container.dataset.replyCount > 1 ? 's' : ''}`;
                } else {
                    icon.className = 'fas fa-chevron-up';
                    btn.innerHTML = `<i class="fas fa-chevron-up"></i> Ocultar respostas`;
                }
            }
        }

        function displayComments(comments) {
            const container = document.getElementById('commentsContainer');
            if (comments.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhum coment√°rio ainda. Seja o primeiro a comentar!</p>';
                return;
            }

            // Ordenar coment√°rios
            let sortedComments = [...comments];
            if (currentSort === 'recent') {
                sortedComments.sort((a, b) => {
                    try {
                        const dateA = new Date(a.created_at);
                        const dateB = new Date(b.created_at);
                        if (isNaN(dateA.getTime()) || isNaN(dateB.getTime())) return 0;
                        return dateB - dateA;
                    } catch (error) {
                        return 0;
                    }
                });
            } else if (currentSort === 'voted') {
                sortedComments.sort((a, b) => {
                    // Calcular rea√ß√µes positivas (like + heart + fire) menos negativas (bad)
                    const aReactions = a.reactions ? 
                        (a.reactions.like || 0) + (a.reactions.heart || 0) + (a.reactions.fire || 0) - (a.reactions.bad || 0) : 0;
                    const bReactions = b.reactions ? 
                        (b.reactions.like || 0) + (b.reactions.heart || 0) + (b.reactions.fire || 0) - (b.reactions.bad || 0) : 0;
                    return bReactions - aReactions;
                });
            } else if (currentSort === 'relevant') {
                // Ordenar por relev√¢ncia: mais rea√ß√µes + mais respostas + mais recente
                sortedComments.sort((a, b) => {
                    // Calcular rea√ß√µes positivas menos negativas
                    const aReactions = a.reactions ? 
                        (a.reactions.like || 0) + (a.reactions.heart || 0) + (a.reactions.fire || 0) - (a.reactions.bad || 0) : 0;
                    const bReactions = b.reactions ? 
                        (b.reactions.like || 0) + (b.reactions.heart || 0) + (b.reactions.fire || 0) - (b.reactions.bad || 0) : 0;
                    
                    // Contar respostas
                    const aReplies = comments.filter(c => c.parent_id === a.id).length;
                    const bReplies = comments.filter(c => c.parent_id === b.id).length;
                    
                    // Score de relev√¢ncia: rea√ß√µes * 2 + respostas * 3 + rec√™ncia (dias desde cria√ß√£o)
                    try {
                        const now = new Date();
                        const dateA = new Date(a.created_at);
                        const dateB = new Date(b.created_at);
                        const daysA = isNaN(dateA.getTime()) ? 999 : Math.floor((now - dateA) / (1000 * 60 * 60 * 24));
                        const daysB = isNaN(dateB.getTime()) ? 999 : Math.floor((now - dateB) / (1000 * 60 * 60 * 24));
                        const aScore = (aReactions * 2) + (aReplies * 3) + (Math.max(0, 7 - daysA));
                        const bScore = (bReactions * 2) + (bReplies * 3) + (Math.max(0, 7 - daysB));
                        return bScore - aScore;
                    } catch (error) {
                        return 0;
                    }
                });
            }

            const topLevelComments = sortedComments.filter(c => !c.parent_id);
            const repliesMap = {};
            sortedComments.filter(c => c.parent_id).forEach(reply => {
                if (!repliesMap[reply.parent_id]) {
                    repliesMap[reply.parent_id] = [];
                }
                repliesMap[reply.parent_id].push(reply);
            });

            container.innerHTML = topLevelComments.map(comment => {
                const replies = (repliesMap[comment.id] || []).sort((a, b) => new Date(a.created_at) - new Date(b.created_at));
                const reactions = comment.reactions || { like: 0, bad: 0, heart: 0, fire: 0 };
                const totalReactions = (reactions.like || 0) + (reactions.bad || 0) + (reactions.heart || 0) + (reactions.fire || 0);
                
                // Verificar se coment√°rio √© longo
                const commentText = escapeHtml(comment.comment);
                const truncated = truncateText(commentText, 200);
                const isLongComment = truncated.isLong;
                
                // Encontrar rea√ß√£o mais usada
                const reactionCounts = {
                    like: reactions.like || 0,
                    bad: reactions.bad || 0,
                    heart: reactions.heart || 0,
                    fire: reactions.fire || 0
                };
                const mostUsedReaction = Object.keys(reactionCounts).reduce((a, b) => reactionCounts[a] > reactionCounts[b] ? a : b);
                const mostUsedEmoji = mostUsedReaction === 'like' ? 'üëç' : mostUsedReaction === 'bad' ? 'üëé' : mostUsedReaction === 'heart' ? '‚ù§Ô∏è' : 'üî•';
                
                return `
                    <div class="comment" data-comment-id="${comment.id}">
                        <div class="comment-header">
                            <div class="comment-author-info">
                                <div class="comment-avatar">${getInitials(comment.name)}</div>
                                <div>
                                    <span class="comment-author">${escapeHtml(comment.name)}</span>
                                    <span class="comment-date">${formatDate(comment.created_at)}</span>
                                </div>
                            </div>
                        </div>
                        <div class="comment-content ${isLongComment ? 'short' : ''}" id="commentContent-${comment.id}" ${isLongComment ? `data-full-text="${commentText.replace(/"/g, '&quot;')}"` : ''}>
                            ${isLongComment ? truncated.text : commentText}
                        </div>
                        ${isLongComment ? `
                            <button class="comment-expand-btn" id="expandBtn-${comment.id}" onclick="toggleCommentExpand('${comment.id}')">
                                Ver mais
                            </button>
                        ` : ''}
                        <div class="comment-reactions">
                            <button class="reaction-btn ${reactions.like > 0 ? 'active' : ''}" onclick="addReaction(${comment.id}, 'like')" title="Curtir">
                                üëç <span class="reaction-count">${reactions.like || 0}</span>
                            </button>
                            <button class="reaction-btn ${reactions.bad > 0 ? 'active' : ''}" onclick="addReaction(${comment.id}, 'bad')" title="N√£o gostei">
                                üëé <span class="reaction-count">${reactions.bad || 0}</span>
                            </button>
                            <button class="reaction-btn ${reactions.heart > 0 ? 'active' : ''}" onclick="addReaction(${comment.id}, 'heart')" title="Amar">
                                ‚ù§Ô∏è <span class="reaction-count">${reactions.heart || 0}</span>
                            </button>
                            <button class="reaction-btn ${reactions.fire > 0 ? 'active' : ''}" onclick="addReaction(${comment.id}, 'fire')" title="Fogo">
                                üî• <span class="reaction-count">${reactions.fire || 0}</span>
                            </button>
                        </div>
                        <div class="comment-actions">
                            <button class="comment-action" onclick="toggleReplyForm('${comment.id}')">
                                <i class="fas fa-reply"></i> Responder
                            </button>
                        </div>
                        <div class="reply-form" id="replyForm-${comment.id}" style="display: none;">
                            <textarea id="replyText-${comment.id}" placeholder="Escreva sua resposta..."></textarea>
                            <div style="display: flex; gap: 8px; justify-content: flex-end;">
                                <button onclick="toggleReplyForm('${comment.id}')" style="padding: 8px 16px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 6px; cursor: pointer; font-size: 0.85rem;">Cancelar</button>
                                <button onclick="submitReply('${comment.id}')">Enviar</button>
                            </div>
                        </div>
                        ${replies.length > 0 ? `
                            <button class="toggle-replies-btn" id="toggleRepliesBtn-${comment.id}" onclick="toggleReplies('${comment.id}')">
                                <i class="fas fa-chevron-down"></i> Ver ${replies.length} resposta${replies.length > 1 ? 's' : ''}
                            </button>
                            <div class="replies-container collapsed" id="repliesContainer-${comment.id}" data-reply-count="${replies.length}">
                                ${replies.map(reply => {
                                    const replyReactions = reply.reactions || { like: 0, bad: 0, heart: 0, fire: 0 };
                                    const replyText = escapeHtml(reply.comment);
                                    const truncatedReply = truncateText(replyText, 150);
                                    const isLongReply = truncatedReply.isLong;
                                    
                                    return `
                                        <div class="comment reply" data-comment-id="${reply.id}">
                                            <div class="comment-header">
                                                <div class="comment-author-info">
                                                    <div class="comment-avatar">${getInitials(reply.name)}</div>
                                                    <div>
                                                        <span class="comment-author">${escapeHtml(reply.name)}</span>
                                                        <span class="comment-date">${formatDate(reply.created_at)}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="comment-content ${isLongReply ? 'short' : ''}" id="commentContent-${reply.id}" ${isLongReply ? `data-full-text="${replyText.replace(/"/g, '&quot;')}"` : ''}>
                                                ${isLongReply ? truncatedReply.text : replyText}
                                            </div>
                                            ${isLongReply ? `
                                                <button class="comment-expand-btn" id="expandBtn-${reply.id}" onclick="toggleCommentExpand('${reply.id}')">
                                                    Ver mais
                                                </button>
                                            ` : ''}
                                            <div class="comment-reactions">
                                                <button class="reaction-btn ${replyReactions.like > 0 ? 'active' : ''}" onclick="addReaction(${reply.id}, 'like')" title="Curtir">
                                                    üëç <span class="reaction-count">${replyReactions.like || 0}</span>
                                                </button>
                                                <button class="reaction-btn ${replyReactions.bad > 0 ? 'active' : ''}" onclick="addReaction(${reply.id}, 'bad')" title="N√£o gostei">
                                                    üëé <span class="reaction-count">${replyReactions.bad || 0}</span>
                                                </button>
                                                <button class="reaction-btn ${replyReactions.heart > 0 ? 'active' : ''}" onclick="addReaction(${reply.id}, 'heart')" title="Amar">
                                                    ‚ù§Ô∏è <span class="reaction-count">${replyReactions.heart || 0}</span>
                                                </button>
                                                <button class="reaction-btn ${replyReactions.fire > 0 ? 'active' : ''}" onclick="addReaction(${reply.id}, 'fire')" title="Fogo">
                                                    üî• <span class="reaction-count">${replyReactions.fire || 0}</span>
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            // Atualizar textos completos ap√≥s renderiza√ß√£o
            setTimeout(() => {
                document.querySelectorAll('[data-full-text]').forEach(el => {
                    const fullText = el.dataset.fullText;
                    if (fullText && !el.classList.contains('expanded')) {
                        // Texto j√° est√° truncado, s√≥ precisamos atualizar quando expandir
                    }
                });
            }, 100);
        }

        // Fun√ß√£o para escapar HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Fun√ß√£o para adicionar rea√ß√£o
        async function addReaction(commentId, reaction) {
            // Verificar autentica√ß√£o (opcional - rea√ß√µes podem ser an√¥nimas)
            const token = localStorage.getItem('authToken') || localStorage.getItem('token') || localStorage.getItem('adminToken');
            
            // Preparar headers
            const headers = {
                'Content-Type': 'application/json'
            };
            
            // Adicionar token se dispon√≠vel (opcional)
            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }

            try {
                // Desabilitar bot√£o durante requisi√ß√£o
                const reactionButtons = document.querySelectorAll(`[onclick*="addReaction(${commentId}"]`);
                reactionButtons.forEach(btn => {
                    btn.disabled = true;
                    btn.style.opacity = '0.6';
                });

                const response = await fetch(`${API_BASE}/blog/comments/${commentId}/reaction`, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify({ reaction })
                });

                if (!response.ok) {
                    // Se for erro de autentica√ß√£o, mostrar modal de login
                    if (response.status === 401 || response.status === 403) {
                        showNotification('Fa√ßa login para adicionar rea√ß√µes', 'warning');
                        showLoginModal();
                        // Reabilitar bot√µes
                        reactionButtons.forEach(btn => {
                            btn.disabled = false;
                            btn.style.opacity = '1';
                        });
                        return;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.success) {
                    showNotification('Rea√ß√£o adicionada!', 'success');
                    
                    // Recarregar coment√°rios para atualizar contadores
                    if (currentPost) {
                        const slug = new URLSearchParams(window.location.search).get('slug');
                        if (slug) {
                            // Recarregar apenas os coment√°rios sem recarregar o post inteiro
                            try {
                                const postResponse = await fetch(`${API_BASE}/blog/posts/${slug}`);
                                const postData = await postResponse.json();
                                if (postData.success && postData.data.post) {
                                    displayComments(postData.data.post.comments || []);
                                }
                            } catch (err) {
                                console.error('Erro ao recarregar coment√°rios:', err);
                                // Fallback: recarregar post completo
                                await loadPost(slug);
                            }
                        }
                    }
                } else {
                    // Reabilitar bot√µes
                    reactionButtons.forEach(btn => {
                        btn.disabled = false;
                        btn.style.opacity = '1';
                    });
                    
                    if (data.message && (data.message.includes('autenticado') || data.message.includes('token'))) {
                        showNotification('Fa√ßa login para adicionar rea√ß√µes', 'warning');
                        showLoginModal();
                    } else {
                        showNotification(data.message || 'Erro ao adicionar rea√ß√£o. Tente novamente.', 'error');
                    }
                }
            } catch (error) {
                console.error('Erro ao adicionar rea√ß√£o:', error);
                
                // Reabilitar bot√µes
                const reactionButtons = document.querySelectorAll(`[onclick*="addReaction(${commentId}"]`);
                reactionButtons.forEach(btn => {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                });
                
                showNotification('Erro de conex√£o. Verifique sua internet e tente novamente.', 'error');
            }
        }

        // Vari√°vel para armazenar conte√∫do antes do login
        let savedCommentData = {
            comment: '',
            replyText: '',
            replyId: null
        };

        // Fun√ß√µes para modal de login
        function showLoginModal(saveComment = false) {
            // Salvar conte√∫do do coment√°rio se necess√°rio
            if (saveComment) {
                const commentText = document.getElementById('commentText');
                if (commentText) {
                    savedCommentData.comment = commentText.value;
                }
                
                // Salvar conte√∫do de resposta se houver formul√°rio aberto
                const replyForms = document.querySelectorAll('.reply-form[style*="block"], .reply-form.active');
                if (replyForms.length > 0) {
                    const form = replyForms[0];
                    const replyId = form.id.replace('replyForm-', '');
                    const replyTextArea = document.getElementById(`replyText-${replyId}`);
                    if (replyTextArea) {
                        savedCommentData.replyText = replyTextArea.value;
                        savedCommentData.replyId = replyId;
                    }
                }
            }
            
            document.getElementById('loginModal').style.display = 'flex';
            // Focar no campo de email ap√≥s pequeno delay para anima√ß√£o
            setTimeout(() => {
                const emailInput = document.getElementById('loginEmail');
                if (emailInput) emailInput.focus();
            }, 100);
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            const errorDiv = document.getElementById('loginError');
            if (errorDiv) errorDiv.style.display = 'none';
            const emailInput = document.getElementById('loginEmail');
            const passwordInput = document.getElementById('loginPassword');
            if (emailInput) emailInput.value = '';
            if (passwordInput) passwordInput.value = '';
        }

        // Fun√ß√£o para fazer login via API
        async function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            const submitBtn = document.getElementById('loginSubmitBtn');

            if (!email || !password) {
                if (errorDiv) {
                    errorDiv.textContent = 'Por favor, preencha todos os campos.';
                    errorDiv.style.display = 'block';
                }
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Entrando...';

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                
                if (data.success && data.token) {
                    // Salvar token
                    localStorage.setItem('authToken', data.token);
                    
                    // Fechar modal
                    closeLoginModal();
                    
                    // Restaurar conte√∫do do coment√°rio se houver
                    if (savedCommentData.comment) {
                        const commentText = document.getElementById('commentText');
                        if (commentText) {
                            commentText.value = savedCommentData.comment;
                            commentText.focus();
                        }
                        savedCommentData.comment = '';
                    }
                    
                    // Restaurar conte√∫do de resposta se houver
                    if (savedCommentData.replyText && savedCommentData.replyId) {
                        const replyTextArea = document.getElementById(`replyText-${savedCommentData.replyId}`);
                        if (replyTextArea) {
                            replyTextArea.value = savedCommentData.replyText;
                            replyTextArea.focus();
                            // Abrir formul√°rio de resposta se estiver fechado
                            const replyForm = document.getElementById(`replyForm-${savedCommentData.replyId}`);
                            if (replyForm) {
                                replyForm.style.display = 'block';
                            }
                        }
                        savedCommentData.replyText = '';
                        savedCommentData.replyId = null;
                    }
                    
                    // Atualizar interface
                    checkAuth();
                    loadUserInfo();
                    
                    // Mostrar feedback
                    showNotification('Login realizado com sucesso!', 'success');
                } else {
                    if (errorDiv) {
                        errorDiv.textContent = data.error || data.message || 'Email ou senha inv√°lidos.';
                        errorDiv.style.display = 'block';
                    }
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Entrar';
                }
            } catch (error) {
                console.error('Erro ao fazer login:', error);
                if (errorDiv) {
                    errorDiv.textContent = 'Erro ao fazer login. Tente novamente.';
                    errorDiv.style.display = 'block';
                }
                submitBtn.disabled = false;
                submitBtn.textContent = 'Entrar';
            }
        }

        // Fun√ß√£o para mostrar notifica√ß√£o
        function showNotification(message, type = 'info') {
            // Remover notifica√ß√£o anterior se existir
            const existing = document.querySelector('.blog-notification');
            if (existing) {
                existing.remove();
            }
            
            const notification = document.createElement('div');
            notification.className = 'blog-notification';
            
            // Cores baseadas no tipo
            const colors = {
                success: '#10b981',
                error: '#ef4444',
                warning: '#f59e0b',
                info: '#3b82f6'
            };
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type] || colors.info};
                color: white;
                padding: 16px 24px;
                border-radius: 12px;
                box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                z-index: 10001;
                animation: slideInRight 0.3s ease;
                max-width: 400px;
                font-size: 0.95rem;
                display: flex;
                align-items: center;
                gap: 12px;
                font-weight: 500;
            `;
            
            notification.innerHTML = `
                <i class="fas ${icons[type] || icons.info}" style="font-size: 18px;"></i>
                <span style="flex: 1;">${message}</span>
                <button onclick="this.parentElement.remove()" style="background: rgba(255,255,255,0.2); border: none; color: white; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 12px; transition: background 0.2s; margin-left: 8px;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentElement) {
                    notification.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }

        // Verificar autentica√ß√£o ao carregar
        function checkAuth() {
            const token = localStorage.getItem('authToken') || localStorage.getItem('token') || localStorage.getItem('adminToken');
            const commentForm = document.getElementById('commentForm');
            const authMessage = document.getElementById('commentAuthMessage');
            const submitBtn = document.getElementById('submitCommentBtn');
            
            if (!token) {
                // Mostrar mensagem mas n√£o desabilitar campos - usu√°rio pode escrever antes de autenticar
                if (authMessage) authMessage.style.display = 'block';
            } else {
                if (authMessage) authMessage.style.display = 'none';
                if (submitBtn) submitBtn.disabled = false;
                if (commentForm) {
                    const inputs = commentForm.querySelectorAll('input, textarea');
                    inputs.forEach(input => input.disabled = false);
                }
            }
        }

        function displayRelatedPosts(posts) {
            const container = document.getElementById('relatedPostsSidebar');
            if (posts.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); font-size: 0.9rem;">Nenhum post relacionado.</p>';
                return;
            }

            container.innerHTML = posts.map(post => `
                <div class="related-post-item" onclick="window.location.href='blog-post.html?slug=${post.slug}'">
                    <a href="blog-post.html?slug=${post.slug}">${post.title}</a>
                    <div class="related-post-meta">
                        <i class="fas fa-eye"></i> ${post.views || 0} visualiza√ß√µes
                    </div>
                </div>
            `).join('');
        }

        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE}/blog/categories`);
                const data = await response.json();
                if (data.success) {
                    const container = document.getElementById('categoriesSidebar');
                    if (data.data.length === 0) {
                        container.innerHTML = '<p style="color: var(--text-secondary); font-size: 0.9rem;">Nenhuma categoria dispon√≠vel.</p>';
                        return;
                    }
                    container.innerHTML = data.data.map(cat => `
                        <div class="category-item">
                            <a href="blog.html?category=${encodeURIComponent(cat.category)}">
                                ${cat.category}
                                <span class="category-count">${cat.count}</span>
                            </a>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Erro ao carregar categorias:', error);
            }
        }

        async function loadRecentPosts() {
            try {
                const response = await fetch(`${API_BASE}/blog/posts?limit=5&sort=published_at`);
                const data = await response.json();
                if (data.success) {
                    const container = document.getElementById('recentPostsSidebar');
                    if (data.data.length === 0) {
                        container.innerHTML = '<p style="color: var(--text-secondary); font-size: 0.9rem;">Nenhum post recente.</p>';
                        return;
                    }
                    container.innerHTML = data.data.map(post => `
                        <div class="related-post-item" onclick="window.location.href='blog-post.html?slug=${post.slug}'">
                            <a href="blog-post.html?slug=${post.slug}">${post.title}</a>
                            <div class="related-post-meta">
                                ${formatDate(post.published_at || post.created_at)}
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Erro ao carregar posts recentes:', error);
            }
        }

        async function submitComment() {
            // Verificar autentica√ß√£o
            const token = localStorage.getItem('authToken') || localStorage.getItem('token') || localStorage.getItem('adminToken');
            if (!token) {
                showLoginModal(true); // Salvar coment√°rio antes de mostrar modal
                return;
            }

            // Obter dados do usu√°rio autenticado
            let userName = '';
            let userEmail = '';
            try {
                const userResponse = await fetch(`${API_BASE}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                if (userResponse.ok) {
                    const userData = await userResponse.json();
                    const user = userData.user || userData;
                    userName = user.nome_completo || user.nome || user.email || '';
                    userEmail = user.email || '';
                }
            } catch (error) {
                console.error('Erro ao obter dados do usu√°rio:', error);
            }

            const name = userName || document.getElementById('commentName').value;
            const email = userEmail || document.getElementById('commentEmail').value;
            const comment = document.getElementById('commentText').value;

            if (!name || !email || !comment) {
                showNotification('Por favor, preencha todos os campos.', 'warning');
                return;
            }

            // Salvar valores antes de enviar (para manter ap√≥s autentica√ß√£o)
            const savedComment = comment;

            try {
                const response = await fetch(`${API_BASE}/blog/comments`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        post_id: currentPostId,
                        name,
                        email,
                        comment
                    })
                });

                // Verificar se √© erro de autentica√ß√£o
                if (response.status === 401 || response.status === 403) {
                    showNotification('Sess√£o expirada. Fa√ßa login novamente.', 'warning');
                    showLoginModal();
                    // Restaurar coment√°rio
                    document.getElementById('commentText').value = savedComment;
                    return;
                }

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                if (data.success) {
                    showNotification('Coment√°rio publicado com sucesso!', 'success');
                    document.getElementById('commentText').value = '';
                    // Recarregar coment√°rios
                    const slug = new URLSearchParams(window.location.search).get('slug');
                    if (slug) {
                        await loadPost(slug);
                    }
                } else {
                    // Verificar se √© erro de token/autentica√ß√£o
                    if (data.message && (data.message.includes('autenticado') || data.message.includes('token') || data.message.includes('sess√£o'))) {
                        showNotification('Sess√£o expirada. Fa√ßa login novamente.', 'warning');
                        showLoginModal();
                    } else {
                        showNotification('Erro ao enviar coment√°rio: ' + (data.message || 'Tente novamente.'), 'error');
                    }
                    // Restaurar coment√°rio se houver erro
                    document.getElementById('commentText').value = savedComment;
                }
            } catch (error) {
                console.error('Erro ao enviar coment√°rio:', error);
                showNotification('Erro de conex√£o. Verifique sua internet e tente novamente.', 'error');
                // Restaurar coment√°rio
                document.getElementById('commentText').value = savedComment;
            }
        }

        async function submitReply(parentId) {
            // Verificar autentica√ß√£o
            const token = localStorage.getItem('authToken') || localStorage.getItem('token') || localStorage.getItem('adminToken');
            if (!token) {
                showLoginModal(true); // Salvar resposta antes de mostrar modal
                return;
            }

            // Obter dados do usu√°rio autenticado
            let userName = '';
            let userEmail = '';
            try {
                const userResponse = await fetch(`${API_BASE}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                if (userResponse.ok) {
                    const userData = await userResponse.json();
                    const user = userData.user || userData;
                    userName = user.nome_completo || user.nome || user.email || '';
                    userEmail = user.email || '';
                }
            } catch (error) {
                console.error('Erro ao obter dados do usu√°rio:', error);
            }

            const name = userName || document.getElementById(`replyName-${parentId}`).value;
            const email = userEmail || document.getElementById(`replyEmail-${parentId}`).value;
            const comment = document.getElementById(`replyText-${parentId}`).value;

            if (!name || !email || !comment) {
                showNotification('Por favor, preencha todos os campos.', 'warning');
                return;
            }

            // Salvar valores antes de enviar
            const savedReply = comment;

            try {
                const response = await fetch(`${API_BASE}/blog/comments`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        post_id: currentPostId,
                        parent_id: parentId,
                        name,
                        email,
                        comment
                    })
                });

                // Verificar se √© erro de autentica√ß√£o
                if (response.status === 401 || response.status === 403) {
                    showNotification('Sess√£o expirada. Fa√ßa login novamente.', 'warning');
                    showLoginModal();
                    // Restaurar resposta
                    document.getElementById(`replyText-${parentId}`).value = savedReply;
                    return;
                }

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                if (data.success) {
                    showNotification('Resposta publicada com sucesso!', 'success');
                    toggleReplyForm(parentId);
                    document.getElementById(`replyName-${parentId}`).value = '';
                    document.getElementById(`replyEmail-${parentId}`).value = '';
                    document.getElementById(`replyText-${parentId}`).value = '';
                    // Recarregar coment√°rios
                    const slug = new URLSearchParams(window.location.search).get('slug');
                    if (slug) {
                        await loadPost(slug);
                    }
                } else {
                    // Verificar se √© erro de token/autentica√ß√£o
                    if (data.message && (data.message.includes('autenticado') || data.message.includes('token') || data.message.includes('sess√£o'))) {
                        showNotification('Sess√£o expirada. Fa√ßa login novamente.', 'warning');
                        showLoginModal();
                    } else {
                        showNotification('Erro ao enviar resposta: ' + (data.message || 'Tente novamente.'), 'error');
                    }
                    // Restaurar resposta se houver erro
                    document.getElementById(`replyText-${parentId}`).value = savedReply;
                }
            } catch (error) {
                console.error('Erro ao enviar resposta:', error);
                showNotification('Erro de conex√£o. Verifique sua internet e tente novamente.', 'error');
                // Restaurar resposta se houver erro
                document.getElementById(`replyText-${parentId}`).value = savedReply;
            }
        }

        function toggleReplyForm(commentId) {
            const form = document.getElementById(`replyForm-${commentId}`);
            if (form) {
                form.style.display = form.style.display === 'none' ? 'block' : 'none';
            }
        }

        // Verificar se post j√° foi curtido
        function hasLikedPost(postId) {
            const likedPosts = JSON.parse(localStorage.getItem('likedPosts') || '[]');
            return likedPosts.includes(postId);
        }

        // Salvar like no localStorage
        function saveLikedPost(postId) {
            const likedPosts = JSON.parse(localStorage.getItem('likedPosts') || '[]');
            if (!likedPosts.includes(postId)) {
                likedPosts.push(postId);
                localStorage.setItem('likedPosts', JSON.stringify(likedPosts));
            }
        }

        // Verificar se post j√° foi visualizado
        function hasViewedPost(postId) {
            const viewedPosts = JSON.parse(localStorage.getItem('viewedPosts') || '[]');
            return viewedPosts.includes(postId);
        }

        // Salvar visualiza√ß√£o no localStorage
        function saveViewedPost(postId) {
            const viewedPosts = JSON.parse(localStorage.getItem('viewedPosts') || '[]');
            if (!viewedPosts.includes(postId)) {
                viewedPosts.push(postId);
                localStorage.setItem('viewedPosts', JSON.stringify(viewedPosts));
            }
        }

        // Registrar visualiza√ß√£o no servidor
        async function registerView(postId) {
            // Verificar se j√° visualizou
            if (hasViewedPost(postId)) {
                return; // J√° visualizou, n√£o registrar novamente
            }

            try {
                const response = await fetch(`${API_BASE}/blog/posts/${postId}/view`, {
                    method: 'POST'
                });
                const data = await response.json();
                if (data.success) {
                    // Salvar no localStorage
                    saveViewedPost(postId);
                    
                    // Atualizar contador de visualiza√ß√µes na p√°gina
                    const viewsElement = document.getElementById('viewsCount');
                    if (viewsElement) {
                        viewsElement.textContent = `${data.data.views} visualiza√ß√µes`;
                    } else {
                        // Fallback: procurar no post-meta
                        const metaSpans = document.querySelectorAll('.post-meta span');
                        metaSpans.forEach(span => {
                            if (span.innerHTML.includes('fa-eye')) {
                                span.innerHTML = `<i class="fas fa-eye"></i> ${data.data.views} visualiza√ß√µes`;
                            }
                        });
                    }
                }
            } catch (error) {
                console.error('Erro ao registrar visualiza√ß√£o:', error);
                // N√£o mostrar erro ao usu√°rio, apenas logar
            }
        }

        // Atualizar visual do bot√£o de like
        function updateLikeButton(postId) {
            const likeButton = document.getElementById('likeButton');
            const likeIcon = document.getElementById('likeIcon');
            
            if (!likeButton) return;
            
            if (hasLikedPost(postId)) {
                likeButton.classList.add('liked');
                likeButton.disabled = true;
                if (likeIcon) {
                    likeIcon.style.color = 'white';
                }
                likeButton.title = 'Voc√™ j√° curtiu este post';
            } else {
                likeButton.classList.remove('liked');
                likeButton.disabled = false;
                likeButton.title = 'Curtir este post';
            }
        }

        async function likePost() {
            if (!currentPostId) {
                showNotification('Erro: Post n√£o identificado', 'error');
                return;
            }
            
            const likeButton = document.getElementById('likeButton');
            const likeIcon = document.getElementById('likeIcon');
            
            // Verificar se j√° curtiu
            if (hasLikedPost(currentPostId)) {
                showNotification('Voc√™ j√° curtiu este post!', 'info');
                return;
            }

            // Desabilitar bot√£o durante a requisi√ß√£o e mostrar loading
            if (likeButton) {
                likeButton.disabled = true;
                if (likeIcon) {
                    likeIcon.className = 'fas fa-spinner fa-spin';
                }
            }

            try {
                const response = await fetch(`${API_BASE}/blog/posts/${currentPostId}/like`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    // Salvar no localStorage
                    saveLikedPost(currentPostId);
                    
                    // Atualizar contador e visual
                    const likeCountElement = document.getElementById('likeCount');
                    if (likeCountElement) {
                        likeCountElement.textContent = data.data?.likes || 0;
                        // Anima√ß√£o de contador
                        likeCountElement.style.transform = 'scale(1.3)';
                        likeCountElement.style.transition = 'transform 0.2s ease';
                        setTimeout(() => {
                            likeCountElement.style.transform = 'scale(1)';
                        }, 200);
                    }
                    
                    updateLikeButton(currentPostId);
                    showNotification('Post curtido com sucesso!', 'success');
                } else {
                    // Reabilitar bot√£o se houver erro
                    if (likeButton) {
                        likeButton.disabled = false;
                        if (likeIcon) {
                            likeIcon.className = 'fas fa-heart';
                        }
                    }
                    showNotification(data.message || 'Erro ao curtir post. Tente novamente.', 'error');
                }
            } catch (error) {
                console.error('Erro ao curtir post:', error);
                // Reabilitar bot√£o se houver erro
                if (likeButton) {
                    likeButton.disabled = false;
                    if (likeIcon) {
                        likeIcon.className = 'fas fa-heart';
                    }
                }
                showNotification('Erro de conex√£o. Verifique sua internet e tente novamente.', 'error');
            }
        }

        function sharePost(platform) {
            try {
                const url = encodeURIComponent(window.location.href);
                const title = encodeURIComponent(currentPost?.title || document.title || '');
                let shareUrl = '';

                switch(platform) {
                    case 'whatsapp':
                        shareUrl = `https://wa.me/?text=${title}%20${url}`;
                        break;
                    case 'facebook':
                        shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
                        break;
                    case 'twitter':
                        shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${title}`;
                        break;
                    case 'linkedin':
                        shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${url}`;
                        break;
                    default:
                        showNotification('Plataforma de compartilhamento n√£o reconhecida', 'error');
                        return;
                }

                if (shareUrl) {
                    const shareWindow = window.open(shareUrl, '_blank', 'width=600,height=400,menubar=no,toolbar=no,location=yes,resizable=yes,scrollbars=yes');
                    
                    if (!shareWindow) {
                        showNotification('Por favor, permita pop-ups para compartilhar', 'error');
                    }
                } else {
                    showNotification('Erro ao gerar link de compartilhamento', 'error');
                }
            } catch (error) {
                console.error('Erro ao compartilhar:', error);
                showNotification('Erro ao compartilhar. Tente novamente.', 'error');
            }
        }

        async function copyLink() {
            const url = window.location.href;
            
            try {
                // Tentar usar Clipboard API moderna
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(url);
                    showNotification('Link copiado para a √°rea de transfer√™ncia!', 'success');
                } else {
                    // Fallback para navegadores mais antigos
                    const textArea = document.createElement('textarea');
                    textArea.value = url;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    try {
                        const successful = document.execCommand('copy');
                        document.body.removeChild(textArea);
                        
                        if (successful) {
                            showNotification('Link copiado para a √°rea de transfer√™ncia!', 'success');
                        } else {
                            throw new Error('execCommand falhou');
                        }
                    } catch (err) {
                        document.body.removeChild(textArea);
                        throw err;
                    }
                }
            } catch (error) {
                console.error('Erro ao copiar link:', error);
                showNotification('Erro ao copiar link. Tente selecionar manualmente da barra de endere√ßo.', 'error');
            }
        }
    </script>
</body>
</html>
